<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EDS API: Receiving live point values</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">EDS API
   </div>
   <div id="projectbrief">Enterprise Data Server Application Programming Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('live_reads.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Receiving live point values</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="input_sync"></a>
Synchronizing read point values</h1>
<p>In order to receive point values, live client must be initialized with <code>AccessMode_Read</code> or <code>AccessMode_ReadWrite</code> argument.</p>
<p>Applications using a live client must also regularly (optimally once per second) call its <a class="el" href="classeds_1_1live_1_1_live_client.html#a1c08a84afcc1ee39d7e8f2f37b0590ef">eds::live::LiveClient::synchronizeInput</a> method. All communication with Online Server, including point value updates, takes place in this function.<br  />
 The call to synchronize input values should be repeated as long as the <a class="el" href="classeds_1_1live_1_1_live_client.html#aa15606d8c4be4cd21926539a783beac2">eds::live::LiveClient::isUpdateRequired</a> method returns <code>true</code>. Clients which fail to periodically synchronize with EDS Server will be marked as timed out and eventually disconnected.</p>
<h1><a class="anchor" id="static_fields"></a>
Static fields</h1>
<p>Each EDS process point has a set of fields, identified by their name (e.g. <code>IESS</code>, <code>DF</code>, <code>TS</code>).</p>
<p>Point fields belongs to one of two categories, depending on the frequency of their updates:</p><ul>
<li>static - these fields rarely change value.<br  />
 Examples of such fields are: <code>IESS</code>, <code>ZD</code>, <code>AUX</code>.</li>
<li>dynamic - their value is frequently updated.<br  />
 Point's timestamps (<code>TS</code>, <code>AT</code>), value (<code>AV</code>, <code>BV</code>, <code>DV</code>, <code>IPV</code>, <code>PV</code>) and status (<code>ST</code>) are stored in dynamic fields.</li>
</ul>
<p>A complete list of process point fields and their update modes can be found in the <a class="el" href="point_fields.html">Process point fields</a> page.</p>
<p>Values of all static fields are available immediately after client initialization. They can be read either through specialized accessor methods (like <a class="el" href="classeds_1_1live_1_1_live_client.html#a38bb05459ed1691fc01f6e1112e80e31">eds::live::LiveClient::pointIESS</a>, <a class="el" href="classeds_1_1live_1_1_live_client.html#a392681e3db5817937971367fc1493c3b">eds::live::LiveClient::pointSecGroups</a>, etc.), or by generic methods which take a field's name or identifier (<a class="el" href="classeds_1_1live_1_1_live_client.html#ad3d4ca1de9c9858c85b1eab309236615">eds::live::LiveClient::readFieldString</a>, <a class="el" href="classeds_1_1live_1_1_live_client.html#ab15581fe0427229730800769f6f51474">eds::live::LiveClient::readFieldFloat</a>, etc.).</p>
<p>To determine whether a static field has changed for any point on the server, applications may call <a class="el" href="classeds_1_1live_1_1_live_client.html#aeabdf2cfdeb4469b2832f3f5d8b8722f">eds::live::LiveClient::staticInfoChanged</a>. The method will return <code>true</code> if a change has occurred since the last call and reset the flag to <code>false</code>.</p>
<h1><a class="anchor" id="dynamic_fields"></a>
Dynamic fields</h1>
<p>EDS uses publish-subscribe pattern to efficiently notify multiple clients about frequent updates of dynamic point fields. Before a client can read values of a point, it must first subscribe it using the <a class="el" href="classeds_1_1live_1_1_live_client.html#ab7ee847fd40c4f16cf4e4aac5a64b4f0">eds::live::LiveClient::setInput()</a> method.</p>
<p>The <a class="el" href="classeds_1_1live_1_1_live_client.html#ab7ee847fd40c4f16cf4e4aac5a64b4f0">eds::live::LiveClient::setInput</a> function expects a local point identifier. See <a class="el" href="point_ids.html">Process point identifiers</a> for more information on the subject.</p>
<p>When a point is marked as input, its value does <em>not</em> become instantly available to the client. EDS API must first notify the Online Server, that it should start sending value updates for the point.<br  />
 This communication occurs during the next call to the <a class="el" href="classeds_1_1live_1_1_live_client.html#a1c08a84afcc1ee39d7e8f2f37b0590ef">eds::live::LiveClient::synchronizeInput</a> method.<br  />
 It is not guaranteed however, that values of dynamic fields for the subscribed point will immediately become available. Occassionaly several synchronization cycles may pass until value of a recently subscribed point reaches the client.</p>
<p>To detect whether a dynamic value of any subscribed point has changed, call the <a class="el" href="classeds_1_1live_1_1_live_client.html#a3daebbf20b43b8de7db93a234c3ff756">eds::live::LiveClient::dynamicInfoChanged</a> method. Note that the flag will be automatically cleared by the call.</p>
<p>Value of a dynamic point field can be obtained by calling a specialized accessor (like <a class="el" href="classeds_1_1live_1_1_live_client.html#a7cf319635b45c401c4f6240ffad7dd9c">eds::live::LiveClient::readAnalog</a>, <a class="el" href="classeds_1_1live_1_1_live_client.html#a923393641e83ef9c46b8685357f8c9e5">eds::live::LiveClient::readPacked</a>, <a class="el" href="classeds_1_1live_1_1_live_client.html#a2cb0df30c4fa7a598311ae34e53672f8">eds::live::LiveClient::pointValue</a>, etc.), or a generic function for reading point fields (like <a class="el" href="classeds_1_1live_1_1_live_client.html#ab15581fe0427229730800769f6f51474">eds::live::LiveClient::readFieldFloat</a>).</p>
<p>If an application is no longer interested in receiving dynamic values of a process point, it should call <a class="el" href="classeds_1_1live_1_1_live_client.html#af90f7ee4b66d048651c778f1c05dc02e">eds::live::LiveClient::unsetInput</a>. Removing subscription for unused points can help reduce network traffic.</p>
<h1><a class="anchor" id="live_read_example"></a>
Example</h1>
<p>Some details are omitted from this example. See <a class="el" href="_live_client_8cpp-example.html">LiveClient.cpp</a> for a complete implementation.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> subscribePoint(LiveClient* client, <span class="keyword">const</span> <span class="keywordtype">char</span>* pointName)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Get lid (local id) of point by its IESS.</span></div>
<div class="line">    <span class="keywordtype">int</span> lid = client-&gt;findByIESS(pointName);</div>
<div class="line">    <span class="keywordflow">if</span> (lid == -1)</div>
<div class="line">    {</div>
<div class="line">      printf(<span class="stringliteral">&quot;Couldn&#39;t find point with IESS &#39;%s&#39;\n&quot;</span>, pointName);</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Subscribe the point.</span></div>
<div class="line">    client-&gt;setInput(lid);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> (<span class="keyword">const</span> Error&amp; exc)</div>
<div class="line">  {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Failed to subscribe point &#39;%s&#39; (%s)\n&quot;</span>, pointName, exc.what());</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> downloadPointValues(LiveClient* client)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Repeat synchronization until all point updates are downloaded.</span></div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">      client-&gt;synchronizeInput();</div>
<div class="line">    } <span class="keywordflow">while</span> (client-&gt;isUpdateRequired());</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> (<span class="keyword">const</span> Error&amp; exc)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Client might be disconnected.</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Failed to synchronize input point values (%s)\n&quot;</span>, exc.what());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> printPointValues(LiveClient* client, <span class="keyword">const</span> <span class="keywordtype">char</span>* pointName)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Get the point&#39;s local identifier from IESS.</span></div>
<div class="line">    <span class="keywordtype">int</span> lid = client-&gt;findByIESS(pointName);</div>
<div class="line">    <span class="keywordflow">if</span> (lid == -1)</div>
<div class="line">    {</div>
<div class="line">      printf(<span class="stringliteral">&quot;Couldn&#39;t find point with IESS &#39;%s&#39;\n&quot;</span>, pointName);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read value of analog point</span></div>
<div class="line">    <span class="keywordtype">char</span> quality;</div>
<div class="line">    <span class="keywordtype">float</span> value = client-&gt;readAnalog(lid, &amp;quality);</div>
<div class="line">    printf(<span class="stringliteral">&quot;lid=%d value=%f%c\n&quot;</span>, lid, value, quality);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read string field by name</span></div>
<div class="line">    std::string iess = client-&gt;readFieldString(lid, <span class="stringliteral">&quot;IESS&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;lid=%d IESS=%s\n&quot;</span>, lid, iess.c_str());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read string field by id</span></div>
<div class="line">    <span class="keywordtype">int</span> unFieldId = client-&gt;fieldIdFromName(<span class="stringliteral">&quot;UN&quot;</span>);</div>
<div class="line">    std::string un = client-&gt;readFieldString(lid, unFieldId);</div>
<div class="line">    printf(<span class="stringliteral">&quot;lid=%d UN=%s\n&quot;</span>, lid, un.c_str());</div>
<div class="line"> </div>
<div class="line">    std::string t = client-&gt;readFieldString(lid, <span class="stringliteral">&quot;T&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;lid=%d T=%s\n&quot;</span>, lid, t.c_str());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read double field</span></div>
<div class="line">    <span class="keywordtype">double</span> tb = client-&gt;readFieldDouble(lid, <span class="stringliteral">&quot;TB&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;lid=%d TB=%f\n&quot;</span>, lid, tb);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> (<span class="keyword">const</span> Error&amp; exc)</div>
<div class="line">  {</div>
<div class="line">    printf(</div>
<div class="line">      <span class="stringliteral">&quot;Failed to read values of point &#39;%s&#39; (%s)\n&quot;</span>,</div>
<div class="line">      pointName,</div>
<div class="line">      exc.what());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Details of client initialization are omitted for brevity.</span></div>
<div class="line">  std::unique_ptr&lt;LiveClient&gt; client = initializeClient();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Points have to be subscribed to receive value updates from server.</span></div>
<div class="line">  <span class="keywordflow">if</span> (!subscribePoint(client.get(), <span class="stringliteral">&quot;PointA&quot;</span>) || !subscribePoint(client.get(), <span class="stringliteral">&quot;PointB&quot;</span>))</div>
<div class="line">  {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Failed to subscribe points\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">  {</div>
<div class="line">    downloadPointValues(client.get());</div>
<div class="line">    printPointValues(client.get(), <span class="stringliteral">&quot;PointA&quot;</span>);</div>
<div class="line">    printPointValues(client.get(), <span class="stringliteral">&quot;PointB&quot;</span>);</div>
<div class="line">    std::this_thread::sleep_for(1s);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">EDS API</a></li><li class="navelem"><a class="el" href="tutorial.html">Tutorial</a></li>
    <li class="footer">Generated on Tue Dec 17 2024 18:16:15 for EDS API by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.0 </li>
  </ul>
</div>
</body>
</html>
